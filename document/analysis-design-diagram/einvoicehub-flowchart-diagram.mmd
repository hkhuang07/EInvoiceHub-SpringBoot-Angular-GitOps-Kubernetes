flowchart TD
    Start([Client Request]) --> Auth{Phase 1: Security}
    
    Auth -- Invalid Key --> 401[GlobalExceptionHandler: 401 Unauthorized]
    Auth -- Valid Key --> RateLimit{Rate Limit / Quota?}
    
    RateLimit -- Exceeded --> 429[Return 429 Too Many Requests]
    RateLimit -- OK --> Validation{Phase 2: Validation}
    
    Validation -- Invalid Data --> 400[GlobalExceptionHandler: 400 Bad Request]
    Validation -- Valid --> InitDB[Phase 3: Initialization]
    
    subgraph Persistence [Data Persistence]
        InitDB --> SaveSQL[MySQL: Create Metadata - Status PENDING]
        InitDB --> SaveMongo[MongoDB: Store Raw Request Payload]
    end
    
    Persistence --> Factory[Phase 4: Provider Selection]
    Factory --> Adapter[Execute Concrete Adapter Logic]
    
    subgraph AdapterLogic [Adapter Processing]
        Adapter --> AuthExt[Auth / Get Token]
        AuthExt --> Transform[Map Data to Provider Format]
        Transform --> Encrypt[Encryption if BKAV]
    end
    
    AdapterLogic --> ExternalAPI{Phase 5: External API Call}
    
    ExternalAPI -- Timeout/Error --> HandleFail[Update MySQL: Status FAILED]
    ExternalAPI -- Success --> HandleSuccess[Update MySQL: Status SUCCESS]
    
    HandleFail --> UpdateLog[MongoDB: Store Error Response]
    HandleSuccess --> UpdateLog2[MongoDB: Store Success Response]
    
    UpdateLog & UpdateLog2 --> Response([Return ApiResponse to Client])