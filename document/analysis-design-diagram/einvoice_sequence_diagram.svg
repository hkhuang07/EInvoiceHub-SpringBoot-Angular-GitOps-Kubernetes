<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" width="1200" height="900">
  <style>
    .title { font-family: sans-serif; font-size: 18px; font-weight: bold; fill: #333; }
    .participant { font-family: sans-serif; font-size: 13px; fill: #333; }
    .lifeline { stroke: #666; stroke-width: 1; stroke-dasharray: 4,2; }
    .message { font-family: sans-serif; font-size: 11px; fill: #333; }
    .return { font-family: sans-serif; font-size: 10px; fill: #666; font-style: italic; }
    .note-box { font-family: sans-serif; font-size: 11px; fill: #333; }
    .phase-label { font-family: sans-serif; font-size: 12px; font-weight: bold; fill: #1565c0; }
    .alt-label { font-family: sans-serif; font-size: 11px; fill: #333; }
  </style>
  
  <!-- Background -->
  <rect width="1200" height="900" fill="white"/>
  
  <!-- Title -->
  <text x="600" y="30" class="title" text-anchor="middle">S∆° ƒë·ªì Sequence - Quy Tr√¨nh Xu·∫•t H√≥a ƒê∆°n</text>
  <text x="600" y="55" class="participant" text-anchor="middle">Invoice Issuance Sequence Diagram - EInvoiceHub</text>
  
  <!-- Participants -->
  <rect x="50" y="80" width="140" height="35" rx="5" fill="#e1f5fe" stroke="#01579b" stroke-width="2"/>
  <text x="120" y="103" class="participant" text-anchor="middle" font-weight="bold">Client App</text>
  
  <rect x="230" y="80" width="140" height="35" rx="5" fill="#ffebee" stroke="#c62828" stroke-width="2"/>
  <text x="300" y="103" class="participant" text-anchor="middle" font-weight="bold">ApiKeyFilter</text>
  
  <rect x="410" y="80" width="140" height="35" rx="5" fill="#fff9c4" stroke="#f57f17" stroke-width="2"/>
  <text x="480" y="103" class="participant" text-anchor="middle" font-weight="bold">InvoiceController</text>
  
  <rect x="590" y="80" width="140" height="35" rx="5" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
  <text x="660" y="103" class="participant" text-anchor="middle" font-weight="bold">InvoiceService</text>
  
  <rect x="770" y="80" width="140" height="35" rx="5" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
  <text x="840" y="103" class="participant" text-anchor="middle" font-weight="bold">ProviderFactory</text>
  
  <rect x="950" y="80" width="140" height="35" rx="5" fill="#fff3e0" stroke="#ef6c00" stroke-width="2"/>
  <text x="1020" y="103" class="participant" text-anchor="middle" font-weight="bold">Concrete Adapter</text>
  
  <!-- Phase Labels -->
  <rect x="50" y="130" width="200" height="25" rx="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="1"/>
  <text x="150" y="147" class="phase-label" text-anchor="middle">Giai ƒëo·∫°n 1: X√°c th·ª±c</text>
  
  <rect x="410" y="130" width="200" height="25" rx="5" fill="#fff3e0" stroke="#ef6c00" stroke-width="1"/>
  <text x="510" y="147" class="phase-label" text-anchor="middle">Giai ƒëo·∫°n 2: X·ª≠ l√Ω y√™u c·∫ßu</text>
  
  <rect x="770" y="130" width="200" height="25" rx="5" fill="#e8f5e9" stroke="#388e3c" stroke-width="1"/>
  <text x="870" y="147" class="phase-label" text-anchor="middle">Giai ƒëo·∫°n 3: Ch·ªçn Provider</text>
  
  <rect x="950" y="130" width="200" height="25" rx="5" fill="#fce4ec" stroke="#c2185b" stroke-width="1"/>
  <text x="1050" y="147" class="phase-label" text-anchor="middle">Giai ƒëo·∫°n 4: G·ªçi API ngo√†i</text>
  
  <!-- Lifelines -->
  <line x1="120" y1="160" x2="120" y2="820" class="lifeline"/>
  <line x1="300" y1="160" x2="300" y2="820" class="lifeline"/>
  <line x1="480" y1="160" x2="480" y2="820" class="lifeline"/>
  <line x1="660" y1="160" x2="660" y2="820" class="lifeline"/>
  <line x1="840" y1="160" x2="840" y2="820" class="lifeline"/>
  <line x1="1020" y1="160" x2="1020" y2="820" class="lifeline"/>
  <line x1="300" y1="520" x2="300" y2="700" class="lifeline" stroke="#7b1fa2"/>
  <line x1="1020" y1="520" x2="1020" y2="700" class="lifeline" stroke="#c2185b"/>
  
  <!-- Database symbol -->
  <ellipse cx="300" cy="610" rx="25" ry="12" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="300" y="614" class="participant" text-anchor="middle" font-size="9">DB</text>
  
  <!-- External API symbol -->
  <ellipse cx="1020" cy="610" rx="30" ry="15" fill="#fce4ec" stroke="#c2185b" stroke-width="2"/>
  <text x="1020" y="614" class="participant" text-anchor="middle" font-size="9">External API</text>
  
  <!-- Messages -->
  <!-- 1. Client to Filter -->
  <line x1="120" y1="180" x2="300" y2="180" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="210" y="175" class="message" text-anchor="middle">POST /api/v1/invoices</text>
  <text x="210" y="195" class="return" text-anchor="middle">Headers: X-CLIENT-ID, X-API-KEY</text>
  
  <!-- 2. Filter to DB -->
  <line x1="300" y1="210" x2="300" y2="590" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="330" y="400" class="message">Validate API Key</text>
  
  <!-- 3. DB to Filter -->
  <line x1="300" y1="610" x2="300" y2="240" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="340" y="420" class="return">Credentials Valid</text>
  
  <!-- 4. Filter to Controller -->
  <line x1="300" y1="260" x2="480" y2="260" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="390" y="255" class="message" text-anchor="middle">Forward Valid Request</text>
  
  <!-- 5. Controller to Service -->
  <line x1="480" y1="290" x2="660" y2="290" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="570" y="285" class="message" text-anchor="middle">issueInvoice(InvoiceRequest)</text>
  
  <!-- 6. Service to Factory -->
  <line x1="660" y1="320" x2="840" y2="320" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="750" y="315" class="message" text-anchor="middle">getProvider(providerCode)</text>
  
  <!-- 7. Factory to Service -->
  <line x1="840" y1="350" x2="660" y2="350" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="750" y="345" class="return" text-anchor="middle">InvoiceProvider Instance</text>
  
  <!-- 8. Service to Adapter -->
  <line x1="660" y1="380" x2="1020" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="840" y="375" class="message" text-anchor="middle">issueInvoice(request, config)</text>
  
  <!-- Alt block for provider-specific logic -->
  <rect x="800" y="410" width="380" height="120" rx="5" fill="none" stroke="#1565c0" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="810" y="430" class="alt-label" font-weight="bold">Logic c·ªßa Provider c·ª• th·ªÉ</text>
  
  <!-- VNPT/Viettel path -->
  <line x1="1020" y1="440" x2="1020" y2="590" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1050" y="500" class="message">HTTP POST + JSON</text>
  <line x1="1020" y1="610" x2="1020" y2="470" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1050" y="550" class="return">JSON Response</text>
  
  <!-- BKAV path -->
  <line x1="1020" y1="440" x2="1020" y2="500" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1060" y="475" class="message">AES-256 Encrypt</text>
  <line x1="1020" y1="500" x2="1020" y2="560" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1060" y="535" class="message">SOAP Request</text>
  <line x1="1020" y1="560" x2="1020" y2="590" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1060" y="580" class="return">SOAP Response</text>
  <line x1="1020" y1="610" x2="1020" y2="500" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1060" y="560" class="return">AES-256 Decrypt</text>
  
  <!-- MISA path -->
  <line x1="1020" y1="440" x2="1020" y2="470" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1060" y="450" class="message">POST /auth/token</text>
  <line x1="1020" y1="610" x2="1020" y2="500" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1060" y="560" class="return">Bearer Token</text>
  <line x1="1020" y1="500" x2="1020" y2="530" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1060" y="520" class="message">HTTP POST + Authorization</text>
  
  <!-- 9. Adapter to Service -->
  <line x1="1020" y1="500" x2="660" y2="500" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="840" y="495" class="return" text-anchor="middle">InvoiceResponse</text>
  
  <!-- 10. Service to DB - Save Metadata -->
  <line x1="660" y1="530" x2="300" y2="530" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="480" y="525" class="message">Save InvoiceMetadata</text>
  
  <!-- 11. Service to DB - Update Status -->
  <line x1="660" y1="560" x2="300" y2="560" stroke="#333" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="480" y="555" class="message">Update Status</text>
  
  <!-- 12. Service to Controller -->
  <line x1="660" y1="620" x2="480" y2="620" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="570" y="615" class="return" text-anchor="middle">InvoiceResponse</text>
  
  <!-- 13. Controller to Client -->
  <line x1="480" y1="650" x2="120" y2="650" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="300" y="645" class="message" text-anchor="middle">HTTP 200 OK + JSON</text>
  
  <!-- Completion -->
  <text x="120" y="680" class="message" fill="#2e7d32" font-weight="bold">‚úì Ho√†n th√†nh th√†nh c√¥ng</text>
  
  <!-- Legend -->
  <rect x="50" y="720" width="1100" height="80" rx="5" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="1"/>
  <text x="70" y="745" class="note-box" font-weight="bold">üìã Ch√∫ th√≠ch:</text>
  <text x="90" y="765" class="note-box">‚Ä¢ Client ‚Üí Filter: G·ª≠i y√™u c·∫ßu k√®m API Key</text>
  <text x="90" y="785" class="note-box">‚Ä¢ Filter ‚Üî DB: X√°c th·ª±c th√¥ng tin ƒëƒÉng nh·∫≠p</text>
  <text x="400" y="765" class="note-box">‚Ä¢ Service ‚Üí Adapter: Chuy·ªÉn ƒë·ªïi v√† g·ª≠i ƒë·∫øn Provider</text>
  <text x="400" y="785" class="note-box">‚Ä¢ Adapter ‚Üî External: Giao ti·∫øp v·ªõi API b√™n ngo√†i</text>
  
  <!-- Provider comparison table -->
  <rect x="50" y="810" width="1100" height="75" rx="5" fill="#fff8e1" stroke="#ffc107" stroke-width="1"/>
  <text x="70" y="835" class="note-box" font-weight="bold">üîÑ So s√°nh Provider:</text>
  <rect x="180" y="825" width="150" height="25" rx="3" fill="#e3f2fd" stroke="#1976d2"/>
  <text x="255" y="842" class="note-box" text-anchor="middle">VNPT/Viettel: REST + JSON</text>
  <rect x="350" y="825" width="150" height="25" rx="3" fill="#fff3e0" stroke="#ef6c00"/>
  <text x="425" y="842" class="note-box" text-anchor="middle">BKAV: WebService + AES-256</text>
  <rect x="520" y="825" width="150" height="25" rx="3" fill="#fce4ec" stroke="#c2185b"/>
  <text x="595" y="842" class="note-box" text-anchor="middle">MISA: REST + OAuth Token</text>
  
  <!-- Arrow marker -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>
</svg>